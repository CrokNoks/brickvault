# GitHub Copilot â€“ Instructions projet LEGO Builder API (NestJS)

## ğŸ¯ Objectif
Ce projet est une API NestJS permettant :
- de lister les sets LEGO,
- dâ€™uploader et consulter les instructions de montage (PDF ou images),
- de gÃ©rer lâ€™inventaire utilisateur (sets et piÃ¨ces),
- et dâ€™intÃ©grer des fournisseurs externes (prix, disponibilitÃ©).

Copilot doit gÃ©nÃ©rer du code **TypeScript propre, modulaire et idiomatique NestJS**, respectant les conventions de ce document.

---

## ğŸ§© Architecture technique
Projet structurÃ© par modules indÃ©pendants :
```
src/
â”œâ”€ app.module.ts
â”œâ”€ auth/
â”œâ”€ users/
â”œâ”€ sets/
â”œâ”€ instructions/
â”œâ”€ pieces/
â”œâ”€ inventory/
â”œâ”€ comments/
â”œâ”€ marketplace/
â”œâ”€ ocr/
â””â”€ common/
```

Chaque module contient :
- `entities/` : classes TypeORM,
- `dto/` : schÃ©mas dâ€™entrÃ©e/sortie,
- `*.controller.ts` : endpoints REST,
- `*.service.ts` : logique mÃ©tier.

---

## ğŸ—ï¸ RÃ¨gles pour Copilot

### 1. GÃ©nÃ©ral
- Langage : **TypeScript**
- Framework : **NestJS**
- ORM : **TypeORM**
- Base : **PostgreSQL**
- Tests : **Jest**
- Style : code clair, sans commentaires inutiles
- Convention : **PascalCase** pour classes, **camelCase** pour variables
- Ã‰viter `any`, prÃ©fÃ©rer des types prÃ©cis

### 2. EntitÃ©s TypeORM
- Chaque entitÃ© hÃ©rite implicitement des champs :
  - `id: number` (PrimaryGeneratedColumn)
  - `createdAt: Date` (CreateDateColumn)
- PrÃ©fÃ©rer `nullable: true` aux valeurs par dÃ©faut non pertinentes.
- Relations bidirectionnelles avec dÃ©corateurs `@ManyToOne`, `@OneToMany`, etc.
- Respecter les contraintes SQL dÃ©finies dans le schÃ©ma initial fourni.

### 3. Services
- Toujours injecter `Repository<Entity>` via `@InjectRepository`.
- Ne pas faire de logique mÃ©tier dans les contrÃ´leurs.
- Inclure validation basique (ex. vÃ©rifier existence avant update/delete).
- Retourner des objets typÃ©s, pas de `Promise<any>`.

### 4. ContrÃ´leurs
- PrÃ©fixer les routes selon le module (`/sets`, `/instructions`, `/inventory`â€¦).
- GÃ©rer les statuts HTTP correctement :
  - 200 pour succÃ¨s
  - 201 pour crÃ©ation
  - 404 pour ressource non trouvÃ©e
  - 400 pour erreur de validation
- Utiliser DTOs pour tous les inputs (`@Body() dto: CreateSetDto`).
- Authentifier les routes sensibles via `@UseGuards(JwtAuthGuard)`.

### 5. DTOs
- Validation avec `class-validator` et `class-transformer`.
- Exemple :
  ```ts
  export class CreateSetDto {
    @IsString()
    @IsNotEmpty()
    legoNumber: string;

    @IsString()
    name: string;

    @IsOptional()
    @IsInt()
    year?: number;
  }

### 6. Upload & OCR

    Pour les fichiers, utiliser FileInterceptor et stockage S3 (ou mock local).

    Les fichiers PDF sont envoyÃ©s au OcrService via une queue Bull (Redis).

    Copilot doit gÃ©nÃ©rer du code compatible avec @nestjs/bull.

### 7. Authentification

    JWT basÃ© sur passport-jwt.

    Hashage avec bcrypt.

    Guards pour routes protÃ©gÃ©es.

    Aucun code en dur pour les secrets.

### 8. Recherche

    IntÃ©gration possible avec Elasticsearch.

    Les requÃªtes de recherche doivent Ãªtre paginÃ©es.

### 9. Documentation

    Utiliser Swagger (@nestjs/swagger).

    Chaque contrÃ´leur doit inclure @ApiTags().

### 10. QualitÃ© & CohÃ©rence

    ESLint + Prettier actifs.

    npm run lint doit passer sans erreur.

    Structure claire pour que Copilot comprenne le contexte dâ€™un module.