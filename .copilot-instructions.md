# GitHub Copilot – Instructions projet LEGO Builder API (NestJS)

## 🎯 Objectif
Ce projet est une API NestJS permettant :
- de lister les sets LEGO,
- d’uploader et consulter les instructions de montage (PDF ou images),
- de gérer l’inventaire utilisateur (sets et pièces),
- et d’intégrer des fournisseurs externes (prix, disponibilité).

Copilot doit générer du code **TypeScript propre, modulaire et idiomatique NestJS**, respectant les conventions de ce document.

---

## 🧩 Architecture technique
Projet structuré par modules indépendants :
```
src/
├─ app.module.ts
├─ auth/
├─ users/
├─ sets/
├─ instructions/
├─ pieces/
├─ inventory/
├─ comments/
├─ marketplace/
├─ ocr/
└─ common/
```

Chaque module contient :
- `entities/` : classes TypeORM,
- `dto/` : schémas d’entrée/sortie,
- `*.controller.ts` : endpoints REST,
- `*.service.ts` : logique métier.

---

## 🏗️ Règles pour Copilot

### 1. Général
- Langage : **TypeScript**
- Framework : **NestJS**
- ORM : **TypeORM**
- Base : **PostgreSQL**
- Tests : **Jest**
- Style : code clair, sans commentaires inutiles
- Convention : **PascalCase** pour classes, **camelCase** pour variables
- Éviter `any`, préférer des types précis

### 2. Entités TypeORM
- Chaque entité hérite implicitement des champs :
  - `id: number` (PrimaryGeneratedColumn)
  - `createdAt: Date` (CreateDateColumn)
- Préférer `nullable: true` aux valeurs par défaut non pertinentes.
- Relations bidirectionnelles avec décorateurs `@ManyToOne`, `@OneToMany`, etc.
- Respecter les contraintes SQL définies dans le schéma initial fourni.

### 3. Services
- Toujours injecter `Repository<Entity>` via `@InjectRepository`.
- Ne pas faire de logique métier dans les contrôleurs.
- Inclure validation basique (ex. vérifier existence avant update/delete).
- Retourner des objets typés, pas de `Promise<any>`.

### 4. Contrôleurs
- Préfixer les routes selon le module (`/sets`, `/instructions`, `/inventory`…).
- Gérer les statuts HTTP correctement :
  - 200 pour succès
  - 201 pour création
  - 404 pour ressource non trouvée
  - 400 pour erreur de validation
- Utiliser DTOs pour tous les inputs (`@Body() dto: CreateSetDto`).
- Authentifier les routes sensibles via `@UseGuards(JwtAuthGuard)`.

### 5. DTOs
- Validation avec `class-validator` et `class-transformer`.
- Exemple :
  ```ts
  export class CreateSetDto {
    @IsString()
    @IsNotEmpty()
    legoNumber: string;

    @IsString()
    name: string;

    @IsOptional()
    @IsInt()
    year?: number;
  }

### 6. Upload & OCR

    Pour les fichiers, utiliser FileInterceptor et stockage S3 (ou mock local).

    Les fichiers PDF sont envoyés au OcrService via une queue Bull (Redis).

    Copilot doit générer du code compatible avec @nestjs/bull.

### 7. Authentification

    JWT basé sur passport-jwt.

    Hashage avec bcrypt.

    Guards pour routes protégées.

    Aucun code en dur pour les secrets.

### 8. Recherche

    Intégration possible avec Elasticsearch.

    Les requêtes de recherche doivent être paginées.

### 9. Documentation

    Utiliser Swagger (@nestjs/swagger).

    Chaque contrôleur doit inclure @ApiTags().

### 10. Qualité & Cohérence

    ESLint + Prettier actifs.

    npm run lint doit passer sans erreur.

    Structure claire pour que Copilot comprenne le contexte d’un module.